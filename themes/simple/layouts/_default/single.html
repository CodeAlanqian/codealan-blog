{{ define "main" }}
  <article class="post">
    <header class="post-header">
      <p class="meta">
        <span>{{ .Date.Format "2006-01-02" }}</span>
        {{ if ne .Lastmod .Date }}
          <span class="meta-updated">Â· æ›´æ–°äº {{ .Lastmod.Format "2006-01-02" }}</span>
        {{ end }}
        {{ if and (ne .RelPermalink "/academic/") .Params.tags }}
          {{ range .Params.tags }}
            <a class="tag" data-tag-key="{{ . | urlize }}" href="{{ (print "/tags/" (. | urlize) "/") | relURL }}">{{ . }}</a>
          {{ end }}
        {{ end }}
      </p>
      <h1>{{ .Title }}</h1>
      <p class="meta meta-views">
        <span class="icon-eye" aria-hidden="true">ğŸ‘</span>
        <span class="view-count" data-key="{{ .RelPermalink }}">0</span> æ¬¡æµè§ˆ Â·
        çº¦ {{ .ReadingTime }} åˆ†é’Ÿé˜…è¯» Â· {{ .WordCount }} å­—
      </p>
      {{ with .Params.cover }}
        <figure class="cover">
          <img src="{{ . | relURL }}" alt="{{ $.Title }}">
        </figure>
      {{ end }}
    </header>
    <div class="post-body">
      {{ with .TableOfContents }}
        <nav class="toc">
          <p class="toc-title">ç›®å½•</p>
          {{ . }}
        </nav>
      {{ end }}
      <div class="content">
        {{ $html := .Content | replaceRE "(<pre[\\s\\S]*?</pre>)" (partial "code-block.html" "${1}") }}
        {{ $html = $html | replaceRE "<img([^>]*?)>" "<img loading=\"lazy\"$1>" }}
        {{ $html | safeHTML }}
      </div>
    </div>
    <footer class="post-footer">
      <section class="post-feedback">
        <button class="post-like-btn" type="button" id="postLikeBtn">
          ğŸ‘ è§‰å¾—æœ‰ç”¨ Â· <span id="postLikeCount">0</span>
        </button>
        <button class="post-donate-btn" type="button" id="postDonateBtn">
          â˜• è¯·æˆ‘å–æ¯å’–å•¡
        </button>
        <div class="post-donate-popup" id="postDonatePopup">
          <p class="post-donate-title">å¾®ä¿¡æ‰«ç èµèµ</p>
          <img src="{{ "/Buy Me a Coffee.jpg" | relURL }}" alt="WeChat QR code" class="post-donate-img">
        </div>
      </section>
      <nav class="post-nav">
        {{ with .Prev }}
          <a class="post-nav-link prev" href="{{ .RelPermalink }}">â† {{ .Title }}</a>
        {{ end }}
        {{ with .Next }}
          <a class="post-nav-link next" href="{{ .RelPermalink }}">{{ .Title }} â†’</a>
        {{ end }}
      </nav>
      <button class="post-share" type="button" id="postShareBtn">å¤åˆ¶æœ¬é¡µé“¾æ¥</button>
      <button class="post-ppt" type="button" id="postPptBtn">PPT å¼é˜…è¯»</button>
      {{ $current := . }}
      {{ $allPages := where site.RegularPages "Type" "in" (slice "posts" "obsidian") }}
      {{ $others := where $allPages "Permalink" "ne" $current.Permalink }}
      {{ $related := slice }}
      {{ with .Params.tags }}
        {{ $related = where $others "Params.tags" "intersect" . }}
      {{ end }}
      {{ if le (len $related) 0 }}
        {{ $related = $others.ByDate.Reverse }}
      {{ end }}
      {{ $related = first 4 $related }}
      {{ if gt (len $related) 0 }}
        <section class="related-block">
          <p class="related-title">ç›¸å…³æ–‡ç« </p>
          <ul class="related-list">
            {{ range $related }}
              <li class="related-item">
                <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                <span class="related-date">{{ .Date.Format "2006-01-02" }}</span>
              </li>
            {{ end }}
          </ul>
        </section>
      {{ end }}
    </footer>
  </article>
  <button class="reading-mode-fab" type="button" id="readingModeFab" aria-label="åˆ‡æ¢é˜…è¯»æ¨¡å¼">é˜…</button>
{{ end }}
