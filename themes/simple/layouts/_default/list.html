{{ define "main" }}
  {{ $pages := .Pages }}
  {{ if .IsHome }}
    {{ $pages = where site.RegularPages "Section" "in" (slice "posts" "obsidian") }}
  {{ end }}
  <section class="hero">
    <h1>{{ .Title }}</h1>
    {{ with .Content }}<div class="lede">{{ . }}</div>{{ end }}
  </section>
  {{ if .IsHome }}
    <section class="profile">
      <div class="avatar">
        <img src="/avatar.png" alt="CodeAlan">
      </div>
      <div>
        <h2 class="name">Hi ğŸ‘‹ This is é¾šæ˜“ä¹¾ (Yiqian Gong, CodeAlan)</h2>
        <p class="bio">
          ğŸ“ å—æ–¹ç§‘æŠ€å¤§å­¦ï¼ˆSUSTechï¼‰ç”µå­ä¿¡æ¯ç¡•å£«åœ¨è¯»ï¼Œå°±è¯»äºå›½å®¶å“è¶Šå·¥ç¨‹å¸ˆå­¦é™¢ï¼ˆNGCEï¼‰ï¼Œç ”ç©¶æ–¹å‘ï¼šè§†è§‰è¯­è¨€å¯¼èˆª VLNï¼ˆVision-Language Navigationï¼Œå®¤å†…/åœ°é¢æ— äººæœºï¼‰ã€‚<br>
          ğŸ”¬ æ¢ç´¢ RL ä¸ LLMï¼Œç†Ÿæ‚‰æ— äººæœºç³»ç»Ÿä¸è¡Œä¸šçº§æ— äººæœºç ”åˆ¶ï¼ˆå«æ²¹ç”µæ··åŠ¨æ— äººæœºï¼‰ã€ArduPilot/PX4 ç”Ÿæ€ä¸æ— äººæœºç®¡æ§å¹³å°å¼€å‘ã€‚<br>
          ğŸ¤– æœ¬ç§‘é˜¶æ®µåœ¨åå—å¸ˆèŒƒå¤§å­¦ï¼ˆSCNUï¼‰RoboMaster æˆ˜é˜Ÿ VANGUARD ä»»å‰¯é˜Ÿé•¿ / è§†è§‰ç»„é•¿ï¼Œä¹Ÿå‚ä¸æ™ºèƒ½è½¦ã€æœºå™¨äººç­‰ç«èµ›å®è·µã€‚<br>
          ğŸ“« è”ç³»ï¼šcodealan@qq.com ï½œ QQ: 2546379375 ï½œ <a href="https://github.com/CodeAlanqian" target="_blank" rel="noreferrer">GitHub</a> ï½œ <a href="https://space.bilibili.com/352156963?spm_id_from=333.1007.0.0" target="_blank" rel="noreferrer">Bç«™</a>
        </p>
      </div>
    </section>
    {{/* é¦–é¡µä¸»æ‰“åŒºåŸŸï¼šå±•ç¤ºæœ€æ–°è‹¥å¹²ç¯‡æ–‡ç« çš„å¤§å¡ç‰‡ */}}
    {{ $ordered := $pages.ByDate.Reverse }}
    {{ $featured := first 2 $ordered }}
    {{ if gt (len $featured) 0 }}
      <section class="home-featured">
        {{ range $featured }}
          {{ partial "article-card.html" . }}
        {{ end }}
      </section>
    {{ end }}
    <section class="home-top-panel">
      <div class="home-top-block">
        <h2 class="home-top-title">ğŸ“ˆ é˜…è¯»é‡ Top</h2>
        <ul class="home-top-list" id="homeTopViews"></ul>
      </div>
      <div class="home-top-block">
        <h2 class="home-top-title">ğŸ‘ ç‚¹èµ Top</h2>
        <ul class="home-top-list" id="homeTopLikes"></ul>
      </div>
      <p class="home-top-hint">ç»Ÿè®¡æ¥è‡ªç«™å†…æœåŠ¡ç«¯æµè§ˆé‡ / ç‚¹èµæ•°æ®ã€‚</p>
    </section>
    <section class="home-topics">
      <h2 class="home-topics-title">ğŸ“š ç²¾é€‰ä¸“é¢˜</h2>
      <div class="home-topics-grid">
        <a class="home-topic-card" href="{{ "/tags/uav/" | relURL }}">
          <div class="home-topic-icon">ğŸ›°ï¸</div>
          <div class="home-topic-body">
            <h3>æ— äººæœºç³»ç»Ÿä¸å¯¼èˆª</h3>
            <p>ä» PX4 / ArduPilot åˆ°å¯¼èˆªä¸æ§åˆ¶ã€è¡Œä¸šçº§æ— äººæœºå®è·µã€‚</p>
          </div>
        </a>
        <a class="home-topic-card" href="{{ "/tags/docker/" | relURL }}">
          <div class="home-topic-icon">ğŸ³</div>
          <div class="home-topic-body">
            <h3>Docker ä¸å·¥ç¨‹ç¯å¢ƒ</h3>
            <p>å®¹å™¨åŒ–å¼€å‘ç¯å¢ƒã€Nextcloudã€LLM æœåŠ¡ä¸å·¥ç¨‹éƒ¨ç½²ç¬”è®°ã€‚</p>
          </div>
        </a>
        <a class="home-topic-card" href="{{ "/tags/vln/" | relURL }}">
          <div class="home-topic-icon">ğŸ§­</div>
          <div class="home-topic-body">
            <h3>VLN / å…·èº«æ™ºèƒ½ç¬”è®°</h3>
            <p>Vision-Language Navigationã€RLã€Embodied AI ç›¸å…³è®ºæ–‡ä¸è¯¾ç¨‹æ‘˜è®°ã€‚</p>
          </div>
        </a>
      </div>
    </section>
    {{ $tags := site.Taxonomies.tags }}
    {{ if gt (len $tags) 0 }}
      <section class="tag-filter">
        <a class="tag-pill is-active" href="{{ "/" | relURL }}">å…¨éƒ¨</a>
        {{ range $name, $_ := $tags }}
          <a class="tag-pill" href="{{ (printf "/tags/%s/" ($name | urlize)) | relURL }}">{{ $name }}</a>
        {{ end }}
      </section>
    {{ end }}
  {{ else }}
    <section class="profile">
      <div class="avatar">
        <img src="/avatar.png" alt="CodeAlan">
      </div>
      <div>
        <h2 class="name">Hi ğŸ‘‹ This is é¾šæ˜“ä¹¾ (Yiqian Gong, CodeAlan)</h2>
        <p class="bio">
          ğŸ“ å—æ–¹ç§‘æŠ€å¤§å­¦ï¼ˆSUSTechï¼‰ç”µå­ä¿¡æ¯ç¡•å£«åœ¨è¯»ï¼Œå°±è¯»äºå›½å®¶å“è¶Šå·¥ç¨‹å¸ˆå­¦é™¢ï¼ˆNGCEï¼‰ï¼Œç ”ç©¶æ–¹å‘ï¼šè§†è§‰è¯­è¨€å¯¼èˆª VLNï¼ˆVision-Language Navigationï¼Œå®¤å†…/åœ°é¢æ— äººæœºï¼‰ã€‚<br>
          ğŸ”¬ æ¢ç´¢ RL ä¸ LLMï¼Œç†Ÿæ‚‰æ— äººæœºç³»ç»Ÿä¸è¡Œä¸šçº§æ— äººæœºç ”åˆ¶ï¼ˆå«æ²¹ç”µæ··åŠ¨æ— äººæœºï¼‰ã€ArduPilot/PX4 ç”Ÿæ€ä¸æ— äººæœºç®¡æ§å¹³å°å¼€å‘ã€‚<br>
          ğŸ¤– æœ¬ç§‘é˜¶æ®µåœ¨åå—å¸ˆèŒƒå¤§å­¦ï¼ˆSCNUï¼‰RoboMaster æˆ˜é˜Ÿ VANGUARD ä»»å‰¯é˜Ÿé•¿ / è§†è§‰ç»„é•¿ï¼Œä¹Ÿå‚ä¸æ™ºèƒ½è½¦ã€æœºå™¨äººç­‰ç«èµ›å®è·µã€‚<br>
          ğŸ“« è”ç³»ï¼šcodealan@qq.com ï½œ QQ: 2546379375 ï½œ <a href="https://github.com/CodeAlanqian" target="_blank" rel="noreferrer">GitHub</a> ï½œ <a href="https://space.bilibili.com/352156963?spm_id_from=333.1007.0.0" target="_blank" rel="noreferrer">Bç«™</a>
        </p>
      </div>
    </section>
  {{ end }}
  {{ $paginator := .Paginate $pages }}
  <section class="post-list">
    {{ range $paginator.Pages }}
      {{ partial "article-card.html" . }}
    {{ end }}
    {{ partial "pagination.html" . }}
  </section>
  {{ if .IsHome }}
    <script>
      (function() {
        const titleMap = new Map();
        {{- range $pages }}
          titleMap.set({{ .RelPermalink | jsonify }}, {{ .Title | jsonify }});
        {{- end }}
        const resolveTitle = (rawPath) => {
          if (!rawPath) return '';
          let path = rawPath;
          try {
            const u = new URL(rawPath, window.location.origin);
            path = u.pathname || rawPath;
          } catch (e) {}
          if (titleMap.has(path)) return titleMap.get(path);
          if (!path.endsWith('/')) {
            const withSlash = path + '/';
            if (titleMap.has(withSlash)) return titleMap.get(withSlash);
          }
          const parts = path.split('/').filter(Boolean);
          if (parts.length > 0) {
            const slug = decodeURIComponent(parts[parts.length - 1] || '')
              .replace(/[-_]+/g, ' ')
              .trim();
            if (slug) return slug;
          }
          return rawPath;
        };
        const renderTop = (id, items) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (!items || !items.length) {
            el.innerHTML = '<li class="home-top-empty">æš‚æ— æ•°æ®</li>';
            return;
          }
          el.innerHTML = items.map((item) => {
            const title = resolveTitle(item.path);
            return '<li class="home-top-item"><a href="' + item.path + '">' + title + '</a><span class="home-top-count">' + item.count + '</span></li>';
          }).join('');
        };
        fetch('/api/stats/top-views?limit=5')
          .then((res) => res.ok ? res.json() : null)
          .then((data) => renderTop('homeTopViews', data))
          .catch(() => renderTop('homeTopViews', null));
        fetch('/api/stats/top-likes?limit=5')
          .then((res) => res.ok ? res.json() : null)
          .then((data) => renderTop('homeTopLikes', data))
          .catch(() => renderTop('homeTopLikes', null));
      })();
    </script>
  {{ end }}
{{ end }}
